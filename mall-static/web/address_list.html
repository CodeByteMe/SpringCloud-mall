<!doctype html>
<html class="no-js" lang="zxx">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="x-ua-compatible" content="ie=edge">
		<title>巢庭万家</title>
		<meta name="description" content="">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="shortcut icon" type="image/x-icon" href="../assets/img/favicon.ico">
		<link rel="stylesheet" href="https://unpkg.com/element-ui@2.13.2/lib/theme-chalk/index.css">
		<!-- Place favicon.ico in the root directory -->

		<!-- CSS here -->
		<link rel="stylesheet" href="../assets/css/bootstrap.min.css">
		<link rel="stylesheet" href="../assets/css/animate.min.css">
		<link rel="stylesheet" href="css/magnific-popup.css">
		<link href="https://s1.pstatp.com/cdn/expire-1-M/font-awesome/5.8.1/css/all.min.css" type="text/css" rel="stylesheet" />
		<link rel="stylesheet" href="../assets/css/dripicons.css">
		<link rel="stylesheet" href="../assets/css/slick.css">
		<link rel="stylesheet" href="../assets/css/default.css">
		<link rel="stylesheet" href="../assets/css/style.css">
		<link rel="stylesheet" href="../assets/css/responsive.css">
		<style type="text/css">
			* {
				margin: 0;
				padding: 0;
				font-family: "microsoft yahei";
			}

			html,
			body {
				background: #f3f3f3;
			}

			ul {
				list-style: none;
			}

			a {
				text-decoration: none;
				color: #555;
			}

			.pro_recommend {
				width: 1200px;
				height: auto;
				margin: 0 auto;
			}

			.pro_recommend h2 {
				font-size: 20px;
				color: #555;
				font-weight: bold;
				margin-bottom: 20px;
			}

			.pro_recommend ul {
				width: 100%;
				height: auto;
				overflow: hidden;
				background: #fff;
			}

			.pro_recommend ul li {
				float: left;
				position: relative;
				overflow: hidden;
				transition: all 0.3s ease 0s;
				width: 319px;
				height: 219px;
				border-right: 1px solid #ebebeb;
				border-bottom: 1px solid #ebebeb;
			}

			.pro_recommend ul li:first-child {
				border: none;
				width: 279px;
				height: 440px;
				border-right: 1px solid #ebebeb;
			}

			.pro_recommend ul li:nth-child(2) {
				float: right;
				border: none;
				width: 280px;
				height: 440px;
			}

			.pro_recommend ul li a {
				display: block;
				width: 100%;
				height: 100%;
				position: absolute;
			}

			.pro_recommend ul li img {
				position: absolute;
				width: 180px;
				height: 180px;
				bottom: 0;
				right: -40px;
				transition: all 0.3s ease 0s;
				vertical-align: middle;
			}

			.pro_recommend ul li:first-child img {
				width: 240px;
				height: 240px;
			}

			.pro_recommend ul li:nth-child(2) img {
				width: 240px;
				height: 240px;
			}

			.pro_recommend ul li .item-text {
				position: absolute;
				top: 30px;
				left: 30px;
			}

			.pro_recommend ul li .item-text strong {
				display: block;
				font-size: 18px;
				font-weight: normal;
				margin-bottom: 10px;
			}

			.pro_recommend ul li .item-text p {
				font-size: 14px;
				margin-bottom: 30px;
			}

			.pro_recommend ul li .item-text span {
				display: inline-block;
				height: 28px;
				line-height: 28px;
				border: 1px solid #fc6451;
				color: #fc6451;
				font-size: 14px;
				padding: 0 20px;
				border-radius: 2px;
				text-align: center;
				transition: all 0.3s ease 0s;
			}

			.pro_recommend ul li .i-p-hot {
				display: block;
				width: 60px;
				height: 60px;
				background: url(../images/icon_bg.png) no-repeat 0 -280px;
				position: absolute;
				right: 0px;
				top: 0px;
			}

			.pro_recommend ul li .i-p-new {
				display: block;
				width: 60px;
				height: 60px;
				background: url(../images/icon_bg.png) no-repeat -80px -280px;
				position: absolute;
				right: 0px;
				top: 0px;
			}

			.pro_recommend ul li .i-p-free {
				display: block;
				width: 60px;
				height: 60px;
				background: url(../images/icon_bg.png) no-repeat -160px -280px;
				position: absolute;
				right: 0px;
				top: 0px;
			}

			.pro_recommend ul li a:hover .item-img {
				right: -20px;
			}

			.item-img {
				border-width: 0px;
			}

			.pro_recommend ul li a:hover .item-text span {
				background: #fc6451;
				border: 1px solid #fc6451;
				color: #fff;
			}
		</style>

	</head>
	<body>
		<div style="width: 80%;margin: auto;">
			<div id="dongyang">
				<!-- header -->
				<header class="header-area">
					<div id="header-sticky" class="menu-area">
						<div class="container">
							<div class="second-menu">
								<div class="row align-items-center">
									<div class="col-xl-2 col-lg-2">
										<div class="logo">
											<a href="index.html"><img src="../assets/img/logo/巢庭万家.png" alt="logo" style="width: 200px;height: 200px;"></a>
										</div>
									</div>
									<div class="col-xl-8 col-lg-9">
										<div class="responsive"><i class="icon dripicons-align-right"></i></div>
										<div class="main-menu text-right text-xl-center">
											<nav id="mobile-menu">
												<ul>
													<li class="has-sub">
														<a href="#home">消息管理</a>
													</li>
													<li class="has-sub"><a href="#">个人中心</a>
														<ul>
															<li><a href="cart.html">购物车</a></li>
															<li><a href="order_list.html">我的订单</a></li>
															<li><a href="address_list.html">地址管理</a></li>
														</ul>
													</li>
													<li><a href="#">送货上门</a></li>
													<li class="has-sub"><a href="product_list.html">所有商品</a>
													</li>
												</ul>
											</nav>
										</div>
									</div>
									<div class="col-xl-2 text-right d-none d-xl-block">
										<div class="header-btn second-header-btn">
											<a href="login.html" class="btn">登录</a>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</header>
				<!-- body -->
				<div style="width: 70%;margin-left: 300px;margin-top: 100px;">
					<h5>收货地址</h3>
				</div>
				<div id="" style="width: 65%;margin: auto;margin-top: 50px;">
					<span style="margin-left: 130px;color: red;">新增收货地址</span>
					<div id="" style="margin-top: 50px;">
						<el-form label-width="80px">
							<el-form-item label="收货人">
								<el-input v-model="name"></el-input>
							</el-form-item>
							<el-form-item label="联系电话">
								<el-input v-model="phoneNumber"></el-input>
							</el-form-item>
							<el-form-item label="邮政编码">
								<el-input v-model="postCode"></el-input>
							</el-form-item>
							<el-form-item label="省份">
								<el-select v-model="province" placeholder="请选择省份" @change="provinceMethod">
									<el-option v-for="item in provinceData" :label="item.provinceName" :value="item.provinceId" :key="item.provinceId"></el-option>
								</el-select>
							</el-form-item>
							<el-form-item label="市">
								<el-select v-model="city" placeholder="请选择城市" @change="cityMethod">
									<el-option v-for="item in cityData" :label="item.cityName" :value="item.cityId" :key="item.cityId"></el-option>
								</el-select>
							</el-form-item>
							<el-form-item label="地区">
								<el-select v-model="region" placeholder="请选择区" @change="regionMethod">
									<el-option v-for="item in regionData" :label="item.regionName" :value="item.regionId" :key="item.regionId"></el-option>
								</el-select>
							</el-form-item>
							<el-form-item label="详细地址">
								<el-input v-model="detailAddress"></el-input>
							</el-form-item>
							<el-form-item>
								<el-button type="primary" @click="onSubmit">立即添加</el-button>
							</el-form-item>
						</el-form>
					</div>
				</div>

				<div id="" style="margin-top: 100px;">
					<template>
						<el-table :data="tableData" style="width: 77%;margin: auto;">
							<el-table-column prop="name" label="收货人" width="180">
							</el-table-column>
							<el-table-column label="所在地区" width="180">
								<template slot-scope="scope">
									{{scope.row.province+scope.row.city+scope.row.region}}
								</template>
							</el-table-column>
							<el-table-column prop="postCode" label="邮政编码">
							</el-table-column>
							<el-table-column prop="phoneNumber" label="联系电话">
							</el-table-column>
							<el-table-column label="操作" fixed="right">
								<template slot-scope="scope">
									<el-button type="text" size="small" @click="handleEdit(scope.$index, scope.row)">编辑</el-button>
									<el-button type="text" size="small" @click.native.prevent="handleDelete(scope.$index, tableData)">删除</el-button>
								</template>
							</el-table-column>
							<el-table-column prop="defaultStatus" label="默认地址">
								<template slot-scope="scope">
									<el-button type="text" size="small" v-if="scope.row.defaultStatus=='0'" @click="updateStatus(scope.row)">设为默认</el-button>
									<p v-if="scope.row.defaultStatus=='1'" style="color: #FFC107;">默认地址</p>
								</template>
							</el-table-column>
						</el-table>
					</template>

					<el-dialog title="编辑地址信息" :visible.sync="dialogVisibleUpdate" width="30%" :before-close="handleClose">
						<el-form label-width="80px">
							<el-form-item label="收货人">
								<el-input v-model="updaterow.name"></el-input>
							</el-form-item>
							<el-form-item label="省份">
								<el-select v-model="province" placeholder="请选择省份" @change="provinceMethod">
									<el-option v-for="item in provinceData" :label="item.provinceName" :value="item.provinceId"  :key="item.provinceId"></el-option>
								</el-select>
							</el-form-item>
							<el-form-item label="市">
								<el-select v-model="city" placeholder="请选择城市" @change="cityMethod">
									<el-option v-for="item in cityData" :label="item.cityName" :value="item.cityId" :key="item.cityId"></el-option>
								</el-select>
							</el-form-item>
							<el-form-item label="地区">
								<el-select v-model="region" placeholder="请选择区" @change="regionMethod">
									<el-option v-for="item in regionData" :label="item.regionName" :value="item.regionId" :key="item.regionId"></el-option>
								</el-select>
							</el-form-item>
							<el-form-item label="邮政编码">
								<el-input v-model="updaterow.postCode"></el-input>
							</el-form-item>
							<el-form-item label="联系电话">
								<el-input v-model="updaterow.phoneNumber"></el-input>
							</el-form-item>
							<el-form-item label="详细地址">
								<el-input v-model="updaterow.detailAddress"></el-input>
							</el-form-item>
						</el-form>
						<span slot="footer" class="dialog-footer">
							<el-button @click="dialogVisibleUpdate = false">取 消</el-button>
							<el-button type="primary" @click="updatesubmit">确 定</el-button>
						</span>
					</el-dialog>
				</div>

				<!-- footer -->
				<footer class="footer-bg footer-p pt-100 pb-80 " style="margin-top: 200px;">

					<div class="footer-top pb-30">
						<div class="container">
							<div class="row justify-content-between">
								<div class="col-xl-3 col-lg-3 col-sm-6">
									<div class="footer-widget mb-30">
										<div class="logo mb-35">
											<a href="#"><img src="../assets/img/logo/巢庭万家.png" alt="logo" style="width: 300px;height: 300px;"></a>
										</div>

										<div class="footer-social">

											<a href="#"><i class="fab fa-facebook-f"></i></a>
											<a href="#"><i class="fab fa-twitter"></i></a>
											<a href="#"><i class="fab fa-instagram"></i></a>
											<a href="#"><i class="fab fa-google-plus-g"></i></a>
										</div>
									</div>
								</div>
								<div class="col-xl-2 col-lg-3 col-sm-6">
									<div class="footer-widget mb-30">
										<div class="f-widget-title">
											<h5>帮助中心</h5>
										</div>
										<div class="footer-link">
											<ul>
												<li><a href="#">购物指南</a></li>
												<li><a href="#">账户管理</a></li>
												<li><a href="#">订单操作</a></li>
												<li><a href="#">防伪查询</a></li>
												<li><a href="#">礼物码</a></li>
												<li><a href="#">服务网点</a></li>
											</ul>
										</div>
									</div>
								</div>
								<div class="col-xl-2 col-lg-3 col-sm-6">
									<div class="footer-widget mb-30">
										<div class="f-widget-title">
											<h5>服务支持</h5>
										</div>
										<div class="footer-link">
											<ul>
												<li><a href="#">售后政策</a></li>
												<li><a href="#">自助服务</a></li>
												<li><a href="#">官方微信</a></li>
												<li><a href="#">服务网点</a></li>
												<li><a href="#">上门维修</a></li>
											</ul>
										</div>
									</div>
								</div>
								<div class="col-xl-3 col-lg-3 col-sm-6">
									<div class="footer-widget mb-30">
										<div class="f-widget-title">
											<h5>关注我们</h5>
										</div>
										<div class="f-insta">
											<ul>
												<li><a href="#"><img src="../assets/img/blog/aside/post_01.jpg" alt="img"></a></li>
												<li><a href="#"><img src="../assets/img/blog/aside/post_02.jpg" alt="img"></a></li>
												<li><a href="#"><img src="../assets/img/blog/aside/post_03.jpg" alt="img"></a></li>
												<li><a href="#"><img src="../assets/img/blog/aside/post_04.jpg" alt="img"></a></li>
												<li><a href="#"><img src="../assets/img/blog/aside/post_05.jpg" alt="img"></a></li>
												<li><a href="#"><img src="../assets/img/blog/aside/post_02.jpg" alt="img"></a></li>
												<li><a href="#"><img src="../assets/img/blog/aside/post_03.jpg" alt="img"></a></li>
												<li><a href="#"><img src="../assets/img/blog/aside/post_04.jpg" alt="img"></a></li>
												<li><a href="#"><img src="../assets/img/blog/aside/post_05.jpg" alt="img"></a></li>
											</ul>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="copyright-wrap">
						<div class="container">
							<div class="row">
								<div class="col-12">
									<div class="copyright-text">
										<p>@ massivex All design Zcube.</p>
									</div>
								</div>
							</div>
						</div>
					</div>
				</footer>
				<!-- footer-end -->
			</div>
	</body>
	<!-- JS here -->
	<script src="https://cdn.jsdelivr.net/npm/vue@2.6.11/dist/vue.js"></script>
	<script src="https://unpkg.com/element-ui@2.13.2/lib/index.js"></script>
	<script src="../assets/js/axios.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="../assets/js/vendor/modernizr-3.5.0.min.js"></script>
	<script src="../assets/js/vendor/jquery-1.12.4.min.js"></script>
	<script src="../assets/js/popper.min.js"></script>
	<script src="../assets/js/bootstrap.min.js"></script>
	<script src="../assets/js/one-page-nav-min.js"></script>
	<script src="../assets/js/slick.min.js"></script>
	<script src="../assets/js/ajax-form.js"></script>
	<script src="../assets/js/paroller.js"></script>
	<script src="../assets/js/wow.min.js"></script>
	<script src="../assets/js/js_isotope.pkgd.min.js"></script>
	<script src="../assets/js/imagesloaded.min.js"></script>
	<script src="../assets/js/parallax.min.js"></script>
	<script src="../assets/js/jquery.waypoints.min.js"></script>
	<script src="../assets/js/jquery.counterup.min.js"></script>
	<script src="../assets/js/jquery.scrollUp.min.js"></script>
	<script src="../assets/js/parallax-scroll.js"></script>
	<script src="../assets/js/jquery.magnific-popup.min.js"></script>
	<script src="../assets/js/element-in-view.js"></script>
	<script src="../assets/js/main.js"></script>
	<script type="text/javascript">
		var vm = new Vue({
			el: "#dongyang",
			data: {
				dialogVisible: false,
				dialogVisibleUpdate: false,
				updateindex: 0,
				updaterow: [],
				tableData: [],
				addressId: '',
				name: '',
				phoneNumber: '',
				postCode: '',
				province: '',
				city: '',
				region: '',
				detailAddress: '',
				provinceData: [],
				cityData: [],
				regionData: []
			},
			beforeMount: function() {
				var tokenStr = "";
				var str = document.cookie;
				var arr = str.split(";");
				for (var i = 0; i < arr.length; i++) {
					var s = arr[i];
					if (s.split("=")[0].trim() == "token") {
						tokenStr = s.split("=")[1];
						break;
					}
				}
				if (tokenStr === "") {
					top.location = "login.html";
				}
				axios({
					method: 'get',
					url: 'http://localhost:8766/address/address/list',
					headers: {
						'token': tokenStr,
					}
				}).then(function(res) {
					vm.tableData = res.data.data;
					console.log(vm.tableData);
				});
				axios({
					method: 'get',
					url: 'http://localhost:8766/address/address/province',
					headers: {
						'token': tokenStr
					},
				}).then(function(res) {
					console.log(res);
					if (res.data.code === 1) {
						top.location = "login.html";
					}
					vm.provinceData = res.data.data;
				});
				this.token = tokenStr;
			},
			methods: {
				provinceMethod: function() {
					console.log(vm.province);
					axios({
						method: 'get',
						url: 'http://localhost:8766/address/address/city',
						headers: {
							'token': vm.token
						},
						params: {
							provinceId: vm.province
						}
					}).then(function(res) {
						console.log(res);
						if (res.data.code === 1) {
							top.location = "login.html";
						}
						vm.cityData = res.data.data;
					});
				},
				cityMethod: function() {
					console.log("city");
					console.log(vm.city);
					axios({
						method: 'get',
						url: 'http://localhost:8766/address/address/region',
						headers: {
							'token': vm.token
						},
						params: {
							cityId: vm.city
						}
					}).then(function(res) {
						console.log(res);
						if (res.data.code === 1) {
							top.location = "login.html";
						}
						vm.regionData = res.data.data;
					});
				},
				regionMethod: function() {
					console.log("region");
					console.log(vm.region);
				},
				onSubmit: function() {
					var tokenStr = "";
					var str = document.cookie;
					var arr = str.split(";");
					for (var i = 0; i < arr.length; i++) {
						var s = arr[i];
						if (s.split("=")[0].trim() == "token") {
							tokenStr = s.split("=")[1];
							break;
						}
					}
					axios({
						method: 'post',
						url: 'http://localhost:8766/address/address/insert',
						headers: {
							'token': tokenStr
						},
						params: {
							name: vm.name,
							phoneNumber: vm.phoneNumber,
							postCode: vm.postCode,
							province: vm.province,
							city: vm.city,
							region: vm.region,
							detailAddress: vm.detailAddress
						}
					}).then(function(res) {
						console.log(res);
						if (res.data.code === 1) {
							top.location = "login.html";
							vm.$message('添加失败');
						}
						vm.$message('添加成功');
						location.href = "address_list.html";
					});
				},
				updatesubmit: function(event) {
					vm.dialogVisible = false;
					axios({
						method: 'post',
						url: 'http://localhost:8766/address/address/update',
						headers: {
							'token': vm.token
						},
						params: {
							addressId: vm.updaterow.addressId,
							name: vm.updaterow.name,
							phoneNumber: vm.updaterow.phoneNumber,
							postCode: vm.updaterow.postCode,
							province: vm.updaterow.province,
							city: vm.updaterow.city,
							region: vm.updaterow.region,
							detailAddress: vm.updaterow.detailAddress
						}
					}).then(function(res) {
						if (res.data.code === 1) {
							vm.$message('更新失败');
						}
						if (res.data.code == 0) {
							vm.$message('更新成功');
							setTimeout(function() {
								location.href = "address_list.html";
							}, 2000);
						}
					});
				},
				handleDelete: function(index, rows) {
					vm.pagesize = event;
					vm.$confirm('此操作将永久删除该文件, 是否继续?', '提示', {
						confirmButtonText: '确定',
						cancelButtonText: '取消',
						type: 'warning'
					}).then(() => {
						axios({
							method: 'delete',
							url: 'http://localhost:8766/address/address/delete',
							headers: {
								'token': vm.token
							},
							params: {
								addressId: rows[index].addressId
							}
						}).then(function(res) {
							if (res.data.code === 1) {
								top.location = "login.html";
							}
							rows.splice(index, 1);
							vm.$message({
								type: 'success',
								message: '删除成功!'
							});
						});
					}).catch(() => {
						vm.$message({
							type: 'info',
							message: '已取消删除'
						});
					});
				},
				handleClose: function(done) {
					this.$confirm('确认关闭？')
						.then(_ => {
							done();
						})
						.catch(_ => {});
				},
				handleEdit: function(index, row) {
					vm.dialogVisibleUpdate = true;
					vm.updateindex = index;

					let obj = JSON.parse(JSON.stringify(row));
					vm.updaterow = obj;
				},
				updateStatus: function(row) {
					console.log(row.addressId)
					axios({
						method: 'post',
						url: 'http://localhost:8766/address/address/updateStatus',
						headers: {
							'token': vm.token
						},
						params: {
							addressId: row.addressId
						}
					}).then(function(res) {
						if (res.data.code === 1) {
							vm.$message('更新失败');
						}
						if (res.data.code == 0) {
							vm.$message('更新成功');
							setTimeout(function() {
								location.href = "address_list.html";
							}, 2000);
						}
					});
				}
			}
		});
	</script>
</html>
